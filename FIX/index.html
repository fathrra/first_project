<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Toko Sepeda</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,600;1,600;1,700&display=swap" rel="stylesheet">
  <style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Poppins', sans-serif;

}

.app {
  display: flex;
  gap: 30px;              /* jarak sidebar ke konten */
  padding: 20px;
}

/* BACKGROUND */
body {
  background: #EDEBE9;
}
/* ===== SIDEBAR MODERN ===== */
.sidebar {
  width: 90px;
  height: calc(100vh - 40px);
  margin: 0px;
  border-radius: 30px;
  background: rgba(255,255,255,0.45);
  backdrop-filter: blur(14px);
  box-shadow: 0 20px 40px rgba(0,0,0,0.18);
  display: flex;
  flex-direction: column;
  align-items: center;
}

/* LOGO */
.logo {
  font-size: 28px;
  margin: 25px 0 35px;
}

/* NAV RESET */
.nav {
  list-style: none;
  padding: 0;
  margin: 0;
  width: 100%;
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 22px;
}

/* ITEM */
.nav-item {
  width: 60px;
  height: 60px;
  border-radius: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  color: #666;
  position: relative;
  z-index: 2;
  transition: all 0.35s cubic-bezier(.4,0,.2,1);
}

/* ICON */
.nav-item .icon {
  font-size: 24px;
  line-height: 1;
}

/* TEXT (DISABLE DULU BIAR GAK NGACO) */
.nav-item .text {
  display: none;
}

/* ACTIVE */
.nav-item.active {
  color: #fff;
}

/* INDICATOR (INI KUNCI UTAMA) */
.nav-indicator {
  position: absolute;
  width: 60px;
  height: 60px;
  border-radius: 18px;
  background: linear-gradient(135deg,#ff9800,#ff6f00);
  border-radius: 18px;
  left: 50%;
  transform: translateX(-50%);
  top: 0;
  z-index: 1;
  transition: top 0.35s cubic-bezier(.4,0,.2,1);
  box-shadow: 0 14px 28px rgba(255,152,0,0.55);
  z-index: 1;
}



/* CONTAINER */
.container {
  flex: 1;
  min-height: 100vh;
  padding: 30px;

  display: flex;
  flex-direction: column;
  gap: 30px; /* jarak header - card - table */
}


/* HEADER */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 35px;
  color: #374151;
}
.hal{
  padding: 10px 28px;
  border-radius: 999px;
  border: none;
  cursor: pointer;

  background: linear-gradient(to right, #ff9800, #ff6f00);
  color: #fff;
  font-weight: 600;
  box-shadow: 0 8px 20px #ff9800
}

.date {
  padding: 10px 28px;
  border-radius: 999px;
  border: none;
  cursor: pointer;

  background: linear-gradient(to right, #4caf50, #66bb6a);
  color: #fff;
  font-weight: 600;
  box-shadow: 0 8px 20px rgba(76,175,80,0.6);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.date:hover {
  transform: translateY(-3px);
  box-shadow: 0 14px 30px rgba(0,0,0,0.18);
}
/* CARDS */
.cards {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 20px;
  margin-bottom: 30px;
}

/* CARD BASE */
.card {
  position: relative;
  border-radius: 16px;
  overflow: hidden;
  min-height: 180px;
    transition: transform 0.35s ease, box-shadow 0.35s ease; 

  /* GLASS EFFECT */
  background: rgba(255, 255, 255, 0.25);
  box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}
.card:hover {
  transform: translateY(-8px);
  box-shadow:
    0 25px 50px rgba(0, 0, 0, 0.25),
    0 10px 25px rgba(0, 0, 0, 0.15);
}



/* HEADER GRADIENT (ATAS CARD) */
.card::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 45px;
}

/* ISI CARD */
.card-content {
  position: relative;
  padding: 15px 20px 20px;
  font-style: italic;
}

/* TEKS */
.card-content p {
  font-size: 15px;
  color: #fff;
  margin-bottom: 30px;
}

.card-content h2 {
  font-size: 35px;
  margin-bottom: 30px;
}

.card-content span {
  font-size: 15px;
  color: #2196f3;
}

/* WARNA GRADASI */
.blue::before {
  background: linear-gradient(to right, #2196f3, #21cbf3);
}

.orange::before {
  background: linear-gradient(to right, #ff9800, #ff6f00);
}

.green::before {
  background: linear-gradient(to right, #34C759, #2F7B00);
}

/* WARNA ANGKA */
.blue h2 { color: #2196f3; }
.orange h2 { color: #ff6f00; }
.green h2 { color: #2e7d32; }

/* TABLE */
.table-box {
  border-radius: 16px;
  padding: 25px;
  color: #374151;

  /* GLASS EFFECT */
  
}

table {
  width: 100%;
  border-collapse: collapse;
}

thead {
  background: #f1f1f1;
}

th, td {
  padding: 12px;
  text-align: left;
  font-size: 15px;
}

th {
  color: #555;
}

tbody tr {
  border-bottom: 1px solid #eee;
}

tbody tr:hover {
  background: #fafafa;
}
/* PEMISAH ANTAR PEMBELI */
tr.spacer td {
  height: 25px;
  background: transparent;
  border: none;
}
  /* ===== BLOK PEMBELI ===== */
.buyer {
  margin-bottom: 35px;
  padding: 20px;
  border-radius: 20px;

  background: rgba(255,255,255,0.35);
  backdrop-filter: blur(8px);
  box-shadow: 0 15px 40px rgba(0,0,0,0.15);
}

/* NAMA PEMBELI */
.buyer-header {
  margin-bottom: 15px;
}

.buyer-name {
  padding: 8px 22px;
  border-radius: 999px;
  background: linear-gradient(to right, #34C759, #2ecc71);
  color: #fff;
  font-size: 14px;
  font-weight: 600;
  box-shadow: 0 6px 20px rgba(52,199,89,0.5);
}

/* TOTAL BAWAH */
.buyer-total {
  margin-top: 15px;
  display: flex;
  justify-content: space-between;
  font-size: 14px;
}

.buyer-total strong {
  font-size: 16px;
}

/* BUTTON */
.btn-add {
  position: sticky;
  bottom: 40px;        /* üîë INI YANG KURANG */

  width: 100%;          /* üîë ini kuncinya */
  margin-top: 25px;    /* jarak dari tabel */
  padding: 22px 0;     /* tinggi tombol */

  border-radius: 999px;
  border: none;
  cursor: pointer;

  background: rgba(255,255,255,0.9);
  backdrop-filter: blur(8px);

  font-size: 16px;
  font-weight: 600;
  color: #6b7280;

  box-shadow: 0 15px 40px rgba(0,0,0,0.25);
}




/* OVERLAY */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.35);
  backdrop-filter: blur(6px);

  display: none;
  justify-content: center;
  align-items: center;
  z-index: 999;
}

/* BOX */
.modal-box {
  width: 500px;
  padding: 30px;
  border-radius: 20px;

  background: rgba(255,255,255,0.9);
  box-shadow: 0 30px 60px rgba(0,0,0,0.25);

  animation: scaleUp 0.3s ease;
}

/* ANIMASI */
@keyframes scaleUp {
  from {
    transform: scale(0.85);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}

/* FORM */
.modal-box h2 {
  margin-bottom: 20px;
}

.modal-box input {
  width: 100%;
  padding: 12px;
  margin-bottom: 14px;
  border-radius: 10px;
  border: 1px solid #ddd;
}

/* ACTION */
.modal-action {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
}

.btn-cancel {
  background: #e5e7eb;
  border: none;
  padding: 10px 18px;
  border-radius: 10px;
}

.btn-save {
  background: linear-gradient(to right, #ff9800, #ff6f00);
  color: #fff;
  border: none;
  padding: 10px 22px;
  border-radius: 10px;
}
.table-wrapper {
  width: 100%;

  margin: 0 auto;
  position: relative;
}
  </style>
</head>
<body>

<div class="app">

<!-- SIDEBAR -->
<!-- SIDEBAR BARU -->
<div class="sidebar">
  <div class="logo"></div>

  <ul class="nav">
    <li class="nav-item active" data-link="index.html">
      <span class="icon">üè†</span>
      <span class="text">Dashboard</span>
    </li>
    <li class="nav-item" data-link="diagram.html">
      <span class="icon">üìà</span>
      <span class="text">Diagram</span>
    </li>
    <li class="nav-item" data-link="data_barang.html">
      <span class="icon">üì¶</span>
      <span class="text">Produk</span>
    </li>

    <div class="nav-indicator"></div>
  </ul>
</div>

  <!-- ISI DASHBOARD -->
  <div class="container">


  <!-- HEADER -->
  <div class="header">
    <h3 class="hal">UTAMA</h3>
    <div class="date" id="todayDate"></div>
    
  </div>
  
  <!-- CARD STATISTIK -->
  <div class="cards">
    
    <div class="card blue">
      <div class="card-content">
        <p>Terjual</p>
        <h2 id="totalTerjual">0</h2>
      </div>
    </div>
    
    <div class="card orange">
      <div class="card-content">
        <p>Pendapatan</p>
        <h2 id="totalPendapatan"></h2>
        <span id="persenPendapatan"></span>
      </div>
    </div>
    
    <div class="card green">
      <div class="card-content">
        <p> pendapatan Kemarin</p>
        <h2 id="pendapatanKemarin">-</h2>
      </div>
    </div>
    
  </div>
  
  <!-- TABEL -->
  <div class="table-wrapper">
  <div class="table-box" id="tableBox">

    <!-- tabel transaksi akan dirender di sini -->
  </div>
  <button class="btn-add" onclick="openModal()">+ Input Data</button>
</div>



<!-- Modal Input -->
<div class="modal-overlay" id="modal" style="display:none;">
  <div class="modal-box">
    <h2>Input Data Pembelian</h2>

    <input type="text" id="userInput" placeholder="Nama User"><br>

    <select id="produkSelect">
      <option value="">Pilih Produk</option>
    </select>

    <input type="number" id="qty" placeholder="Jumlah" min="1">

      <button onclick="addItem()">+ Tambah</button>
<ul id="listItem"></ul>

    <div class="modal-action">
      <button class="btn-cancel" onclick="closeModal()">Batal</button>
      <button type="button" class="btn-save" onclick="saveTransaction()">Simpan</button>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  window.openModal = () => document.getElementById('modal').style.display = 'flex';
  window.closeModal = () => document.getElementById('modal').style.display = 'none';

  let users = [];
  let produk = [];

function setTodayDate() {
  const hari = [
    'MINGGU','SENIN','SELASA','RABU','KAMIS','JUMAT','SABTU'
  ];

  const now = new Date();
  const namaHari = hari[now.getDay()];
  const tanggal = now.getDate();
  const bulan = now.getMonth() + 1;
  const tahun = now.getFullYear();

  document.getElementById('todayDate').textContent =
    `${namaHari} - ${tanggal}-${bulan}-${tahun}`;
}

setTodayDate();


  async function loadDropdowns() {
    // Load produk
    try {
      const resProduk = await fetch('api/produk.php');
      const dataProduk = await resProduk.json();
      produk = dataProduk.data || [];
      renderProdukDropdown();
    } catch(err) {
      console.error("Gagal fetch produk:", err);
      produk = [];
      renderProdukDropdown();
    }
  }

  
  function renderProdukDropdown() {
    const sel = document.getElementById('produkSelect');
    if (!produk.length) {
      sel.innerHTML = `<option value="">Tidak ada produk</option>`;
      return;
    }
    sel.innerHTML = `<option value="">Pilih Produk</option>` +
      produk.map(p => `<option value="${p.id_produk}">${p.nama} - Rp ${Number(p.harga).toLocaleString()}</option>`).join('');
  }

  function renderCart() {
  console.log('renderCart dipanggil');
}


  window.saveTransaction = async function () {
  const today = new Date().toISOString().slice(0,10);
  const userName = document.getElementById('userInput').value.trim();
  
  
  console.log("KLIK SIMPAN");
  console.log("CART:", cart);



  try {
    const res = await fetch('api/transaksi_add.php', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        test: 'OK',
        userName: userName,
        tanggal: today,
        items: cart
      })
    });
const data = await res.json();
    if (data.status) {
      alert("Transaksi berhasil disimpan!");
      cart = [];       // reset cart
      renderCart();    // update tampilan cart
      loadTransaksi(); // <-- reload tabel transaksi langsung
      window.location.href = 'index.html';
    } else {
      alert("Gagal menyimpan transaksi: " + data.message);
    }
  } catch (err) {
    console.error("ERROR SIMPAN:", err);
    alert("Terjadi error saat menyimpan transaksi.");
  }
};





  async function loadTransaksi() {
  const tableBox = document.getElementById('tableBox');
  const totalTerjualEl = document.getElementById('totalTerjual');
  const totalPendapatanEl = document.getElementById('totalPendapatan');
  const spanPendapatan = document.querySelector('#totalPendapatan + span');
  const pendapatanKemarinEl = document.getElementById('pendapatanKemarin');



  let totalTerjual = 0;
  let totalPendapatan = 0; 
  let totalPendapatanKemarin = 0;  // üîë inisialisasi di sini
    const today = new Date();
  const yesterday = new Date(today);
  yesterday.setDate(today.getDate() - 1);
  

  try {
    const res = await fetch('api/transaksi.php');
    const data = await res.json();
    console.log("Data transaksi:", data);

    if (!data.data || !data.data.length) {
  tableBox.innerHTML = '<p>‚ö†Ô∏è Belum ada transaksi</p>';

  totalTerjualEl.textContent = '-';
  totalPendapatanEl.textContent = 'Belum ada transaksi';
  pendapatanKemarinEl.textContent = '-';
  spanPendapatan.textContent = '';
      return;
    }

    let html = '';
    let currentUser = null;
    let total = 0;
    let no = 1;

    data.data.forEach(item => {
  if (!item) return;

  const itemDate = new Date(item.created_at);
  const todayStr = today.toDateString();
  const yesterdayStr = yesterday.toDateString();

  // =========================
  // üî¢ HITUNG STATISTIK
  // =========================

  // TOTAL TERJUAL & PENDAPATAN HARI INI
  if (itemDate.toDateString() === todayStr) {
    totalTerjual += Number(item.qty || 0);
    totalPendapatan += Number(item.subtotal || 0);
  }

  // üî• PENDAPATAN KEMARIN
  if (itemDate.toDateString() === yesterdayStr) {
    totalPendapatanKemarin += Number(item.subtotal || 0);
  }

  // =========================
  // üìã TABEL ‚Üí HARI INI SAJA
  // =========================
  if (itemDate.toDateString() !== todayStr) return;
      // Render tabel per user
      if (currentUser !== item.user_id) {
        if (currentUser !== null) {
          html += `</tbody></table>
          <div class="buyer-total">Total: Rp ${total.toLocaleString()}</div></div>`;
        }
        currentUser = item.user_id;
        total = 0;
        no = 1;
        html += `<div class="table-wrapper">
          <div class="table-box">
          <div class="buyer">
          <div class="buyer-header">
          <span class="buyer-name">${item.nama_user || '-'}</span>
          </div>
          <table>
          <thead>
          <tr>
            <th>No</th>
            <th>Produk</th>
            <th>Tipe</th>
            <th>Harga</th>
            <th>Qty</th>
            <th>Total</th>
          </tr>
          </thead>
          <tbody>`;
      }

      const itemSubtotal = Number(item.subtotal || 0);

      html += `<tr>
        <td>${no++}</td>
        <td>${item.nama || '-'}</td>
        <td>${item.tipe || '-'}</td>
        <td>Rp ${item.harga ? Number(item.harga).toLocaleString() : 0}</td>
        <td>${item.qty ? item.qty : 0}</td>
        <td>Rp ${itemSubtotal.toLocaleString()}</td>
      </tr>`;

      total += itemSubtotal;
    });

    html += `</tbody></table>
      <div class="buyer-total">Total: Rp ${total.toLocaleString()}</div></div>`;

    tableBox.innerHTML = html;

   // Update total terjual & pendapatan hari ini
totalTerjualEl.textContent = totalTerjual;
totalPendapatanEl.textContent = `Rp ${totalPendapatan.toLocaleString()}`;

// Update pendapatan kemarin
pendapatanKemarinEl.textContent = `Rp ${totalPendapatanKemarin.toLocaleString()}`;

// HITUNG PERSENTASE UNTUK SPAN
let persen = 0;
if(totalPendapatanKemarin > 0){
  persen = Math.round(((totalPendapatan - totalPendapatanKemarin)/totalPendapatanKemarin) * 100);
}

if(persen > 0){
  spanPendapatan.textContent = `‚ñ≤ ${persen}% lebih baik`;
  spanPendapatan.style.color = '#2e7d32'; // hijau
} else if(persen < 0){
  spanPendapatan.textContent = `‚ñº ${Math.abs(persen)}% lebih buruk`;
  spanPendapatan.style.color = '#c62828'; // merah
} else {
  spanPendapatan.textContent = '¬± 0% sama seperti kemarin';
  spanPendapatan.style.color = '#555'; // netral
}


  } catch (err) {
    console.error("ERROR loadTransaksi:", err);
    tableBox.innerHTML = '<p>‚ö†Ô∏è Gagal memuat transaksi</p>';
    totalTerjualEl.textContent = '0';
    totalPendapatanEl.textContent = 'Rp 0';
  }
}






  loadDropdowns();
  loadTransaksi();
});
</script>

<script>
let cart = [];

function addItem(){
  const produk = document.getElementById('produkSelect');
  const qty = document.getElementById('qty');

  if(!produk.value || !qty.value){
    alert("Pilih produk & qty");
    return;
  }

  cart.push({
    produk_id: produk.value,
    qty: qty.value
  });

  renderItem();
}

function renderItem(){
  const ul = document.getElementById('listItem');
  ul.innerHTML = '';

  cart.forEach((item,i)=>{
    ul.innerHTML += `
      <li>
        Produk: ${item.produk_id} | jumlah: ${item.qty}
        <button onclick="hapus(${i})">x</button>
      </li>
    `;
  });
}

function hapus(i){
  cart.splice(i,1);
  renderItem();
}

const items = document.querySelectorAll('.nav-item');
const indicator = document.querySelector('.nav-indicator');

function moveIndicator(el){
  indicator.style.top = el.offsetTop + 'px';
}

items.forEach(item => {
  item.addEventListener('click', () => {
    items.forEach(i => i.classList.remove('active'));
    item.classList.add('active');
    moveIndicator(item);

    // pindah halaman
    const link = item.getAttribute('data-link');
    if(link) window.location.href = link;
  });
});

// posisi awal
const activeItem = document.querySelector('.nav-item.active');
if(activeItem) moveIndicator(activeItem);




</script>


</body>
</html>